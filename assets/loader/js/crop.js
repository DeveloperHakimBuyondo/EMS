(()=>{var _=(e,t)=>e.reduce((n,s)=>n.then(m=>t(s).then(u=>m.concat([u]))),Promise.resolve([]));var O=e=>{let t=new DataTransfer;return e.forEach(n=>t.items.add(n)),Object.defineProperty(t,"items",{value:e.map(n=>(n.getAsFile=()=>n,n))}),t};var A=(e,t)=>document.documentElement.addEventListener(e,t,!0);var q=(e,t)=>{let n=O(t);e.files=n.files};var P=(e,t,n={},s={})=>{let{bubbles:m=!0,detail:u,cancelable:c=!0}=s,l=new CustomEvent(t,{bubbles:m,cancelable:c,detail:u});return Object.assign(l,n),e.dispatchEvent(l),l};var ue=["x","y","screenX","screenY","layerX","layerY","pageX","pageY","offsetX","offsetY","clientX","clientY"],U=(e,{didIntercept:t,shouldHandleChange:n,shouldHandleDrop:s},m)=>{let u=(c,l)=>_(Array.from(c),f=>e(f,l));A("change",c=>{let{target:l}=c;if(l.ignoreChangeEvent||c.$cropguide)return;let f=n(c);!f||(t(c),c.stopImmediatePropagation(),u(l.files,f).then(o=>{m("processed selected files",o),l.ignoreChangeEvent=!0,q(l,o.filter(Boolean)),delete l.ignoreChangeEvent;let p=P(l,"change",{$cropguide:!0});m("dispatched CustomEvent",[l,p])}))}),A("drop",c=>{if(c.$cropguide)return;let l=s(c);if(!l)return;t(c);let{target:f}=c;c.preventDefault(),c.stopImmediatePropagation();let o=ue.reduce((p,g)=>(p[g]=c[g],p),{});u(c.dataTransfer.files,l).then(p=>{m("processed dropped files",p);let g=O(p.filter(Boolean)),x=P(f,"drop",{...o,dataTransfer:{effectAllowed:"all",types:["Files"],files:g.files,items:g.items,getData:()=>""},$cropguide:!0});m("dispatched CustomEvent",[f,x])})})};var V=()=>window&&"DataTransfer"in window;var W=(e,{parent:t,onerror:n})=>{let s=document.createElement("script");return s.defer=!0,s.async=!0,s.src=e,s.onerror=n,(t||document.head).append(s),s};var j=e=>e&&/input/i.test(e.tagName)&&e.type==="file";var D=e=>e&&e.type&&/png|jpeg|gif|bmp|webp/.test(e.type);var J=e=>!(!j(e.target)||!e.target.files.length||!Array.from(e.target.files).some(D));var K=e=>!(j(e.target)||!e.dataTransfer||!e.dataTransfer.files.length||!Array.from(e.dataTransfer.files).some(D));var fe=e=>e.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1."),Q=e=>{let t=Date.now(),n="CropGuide";return e?(...s)=>{let m=Date.now()-t,u=`${fe(m)}ms`.padStart(8," "),c="";typeof s[0]=="string"?(c=u+" "+n+" "+s[0],params=s.splice(1)):(c=u,params=[...s]),params.length?console.log(c,params):console.log(c)}:()=>{}};var Z="application/json",B=(e,t={},{method:n="POST"}={})=>fetch(e,{headers:{Accept:Z,"Content-Type":Z},method:n,body:JSON.stringify(t)}).catch(console.log);var ee=(e,t)=>{if(t==="html"||e.matches(t))return!0;let s=document.querySelector(t);return s?s.contains(e):!1};var te=e=>new File([e],e.name,{type:e.type,lastModified:e.lastModified});var oe=()=>{try{let[e,t,n]=getComputedStyle(document.documentElement).backgroundColor.match(/[0-9]+/g).map(m=>parseInt(m,10));return .2126*e+.7152*t+.0722*n>100}catch(e){return!1}};var re=()=>{try{return localStorage.getItem("cgdebug")==="1"}catch(e){}};var ne=(e,t)=>!t||!t.length?!0:e&&e.type&&t.includes(e.type);var M=e=>new File([e],e.name,{type:e.type,lastModified:e.lastModified});((e,t,{hookId:n,apiURL:s,localeURL:m,clientURL:u})=>{let l=new URL(t.currentScript.src).searchParams,f=l.get("debug")!==null||re(l),o=Q(f);if(!V())return o("not supported on this browser");let p=l.get("c");if(!p)return o("clientId not found");let g=e[n],x=[];if(g){if(g.fields)x=g.fields.map(r=>typeof r=="string"?{selector:r}:r),e[n]=void 0,o("local fields config loaded",x);else if(typeof g=="object")return o("client already initialised")}let h=(r,i)=>P(t.documentElement,`${n}:${r}`,void 0,{detail:i});h("init"),o("init",p);let y,H,Y,d,ie=(r="auto")=>{if(r!=="auto")return r.toLowerCase()||"en";let i=(t.documentElement.lang||"en").substring(0,2).toLowerCase();return/^(en|es|fr|de|ru|zh)$/i.test(i)?i:"en"},R=(r,i,F)=>{if(!F(i))return o(`skip ${i.type} event`,i),!1;let v=r.find(({selector:L})=>ee(i.target,L));return!v||v.field.disabled&&!f?(o(`skip ${i.type} event`,i),!1):(o(`handle ${i.type} event`,i,v),v)},se=(r,i)=>({selector:i.selector,field:{...r.field,...i.field},editor:{...r.editor,...i.editor}}),z=()=>{let{banner:r}=y,i=x.length?x.map(a=>{let S=y.fields.find(E=>E.selector===a.selector)||y.fields.find(E=>E.selector==="html");return se(S,a)}):y.fields;o("fields config",i);let{userAgent:F,maxTouchPoints:v,platform:L}=navigator,C=/^mac/i.test(L),w=/iPhone|iPad|iPod/.test(F)||C&&v>=1;if(w){let a=t.createElement("style");a.textContent=".CropGuideDocumentLock,.CropGuideDocumentLock body {height: var(--crop-guide-document-height);overflow-y: hidden;box-sizing: border-box;}.CropGuideDocumentLock body {position:relative;}.CropGuideDocumentLock .CropGuideFrame {height: 100% !important;}",t.head.append(a)}let $,I=()=>t.documentElement.style.setProperty("--crop-guide-document-height",`${window.innerHeight}px`),ae=()=>{o("will show editor"),d.style.pointerEvents="all",d.style.width="100%",d.style.height="100vh",!!w&&I()},ce=()=>{o("did show editor"),h("open"),!!w&&($===void 0&&($=e.scrollY),t.documentElement.classList.add("CropGuideDocumentLock"),I(),e.addEventListener("resize",I))},le=()=>{o("will hide editor"),d.style.pointerEvents="none",!!w&&(e.removeEventListener("resize",I),t.documentElement.classList.remove("CropGuideDocumentLock"),e.scrollTo(0,$),$=void 0)},de=()=>{o("did hide editor"),h("close"),d.style.width=0,d.style.height=0};U((a,S)=>new Promise(E=>{if(!D(a)||!ne(a,S.field.accept))return o("ignore",a),h("ignore",{src:a}),E(a);o("edit",a);let me=oe(),pe={locale:H,banner:r,pageIsBright:me,willShowEditor:ae,didShowEditor:ce,willHideEditor:le,didHideEditor:de},G=()=>{d.removeEventListener("load",G),d.style.pointerEvents="all",Y(a,{log:o,env:pe,requirements:S}).then(b=>{if(!b){E(M(a));return}let T=te(b);o("processed",T),B(`${s}/meter`,{clientId:p}),h("process",{src:a,dest:T}),E(T)}).catch(b=>{let T=b;b.hasOwnProperty("message")?T={error:b.message+" "+b.stack}:typeof b=="string"&&(T={error:b});let{error:k}=T;if(/image too small/i.test(k))return o("image too small",a),h("invalid",{src:a}),E();o("error",k),B(`${s}/report`,{clientId:p,error:k}),h("error",{src:a,error:k}),E(M(a))}).finally(()=>{d.style.pointerEvents="none"})};d.isConnected?G():(d.addEventListener("load",G),document.body.append(d))}),{didIntercept:a=>h("intercept",a),shouldHandleChange:a=>R(i,a,J),shouldHandleDrop:a=>R(i,a,K)},o),h("load")},N=(r,i,F)=>{if(!r){o(`wait for ${i} to load`);return}F()};e[n]={_setLocale:r=>{o("locale loaded",r),H=r,N(Y,"editor",z)},_setEditor:r=>{o("client loaded"),Y=r,N(H,"locale",z)}};let X=s+"/config/"+p;o("load config",X),fetch(X).then(r=>r.text()).then(r=>{o("config loaded");try{y=JSON.parse(r,(C,w)=>w===null?void 0:w)}catch(C){o("failed to parse config",r);return}if(o("config parsed",y),y.status==="Inactive"){o("inactive",y);return}let i=ie(y.locale);o("inject locale",m,i),W(m+`/${i}.js`,{onerror:C=>o("locale inject error",C||{})});let L=".PinturaButtonExport{color:rgb(var(--color-background))!important;background:rgb(var(--color-foreground))!important}";d=t.createElement("iframe"),d.onerror=C=>o("iframe load error",C),d.allowtransparency=!0,d.className="CropGuideFrame",d.style.cssText="position:fixed;left:0;top:0;width:0;height:0;border:0;z-index:2147483647;pointer-events:none;touch-action:manipulation;user-select:none;",o("inject client",u),d.srcdoc='<!DOCTYPE html><html lang="'+i+'"><meta charset="utf-8"><title>crop.guide</title><style>'+L+'</style><script src="'+u+'"><\/script></html>',o("append client frame"),t.body.append(d)}).catch(r=>o("config load error",r))})(window,document,{hookId:"$cropguide",apiURL:"https://app.crop.guide/api",localeURL:"https://cdn.crop.guide/locale",clientURL:"https://cdn.crop.guide/client/l.js"});})();